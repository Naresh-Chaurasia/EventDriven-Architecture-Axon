= 1- Payment Platform
:toc: right
:toclevels: 5
:sectnums: 5
:sectnumlevel: 5

== Project Overview

* *Domain*: Payments | Event-Driven Architecture | Distributed Systems | Resilience & Observability

##############################################


== eureka-discovery-service-ri-3x (8761)

* [ ] http://localhost:8761/
* [ ] Spring Cloud Version: 2022.0.2
* [ ] Spring Boot Version: 3.0.6
* [ ] Only Discovery Service

----
cd /Users/nareshchaurasia/nc/Java-Architect/EventDriven-Architecture-Axon/eureka-discovery-service-ri-3x
./run-ms.sh
----

##############################################

== api-gateway-ri-3x (8010)

* [ ] http://localhost:8010/api/hello
* [ ] Spring Cloud Version: 2022.0.2
* [ ] Spring Boot Version: 3.0.6
* [ ] Routing
* [ ] JWT Token Validation


##############################################


== user-ri-3x (8020)

* [ ] http://localhost:8020/
* [ ] User Registration + Login + JWT Token Generation

=== Direct Call

* http://localhost:8020/users/status/check (Call Directly. WebSecurity allows it)
* http://localhost:8020/h2-console/login.jsp (Call Directly. WebSecurity allows it)
* http://localhost:8020/swagger-ui/index.html (Call Directly. WebSecurity allows it)
* POST: http://localhost:8020/users


=== Via Gateway

- **User**
- http://localhost:8010/users/status/check (No Security at User MS. It just needs JWT token for access)
- POST: http://localhost:8010/users
- **User Actuator via Gateway**
- http://localhost:8010/users-ri-3x/actuator/mappings
- http://localhost:8010/users-ri-3x/actuator/health

- **Gateway Actuator**
- http://localhost:8010/actuator/gateway/routes
- http://localhost:8010/actuator/health  
- http://localhost:8010/actuator/info

##############################################

== dummy-ms-3x


---

##############################################


##############################################


== jwt-ri-3x (8030)

* @PropertySource("classpath:jwt-application.properties")

---

##############################################


---

##############################################





##############################################

== ✔️ core-events-ri-lti 

* *Location*: `/Users/nareshchaurasia/nc/Java-Architect/Java-CQRS-SAGA/core-events-ri-lti`

* *Purpose*: Shared event definitions for the payment processing platform

##############################################

*Classes Created*


* *PaymentEvent.java*: Base abstract class for all payment-related events in the CQRS event-driven architecture.
  Base abstract event class

* *PaymentInitiatedEvent.java* : Event fired when a new payment transaction is initiated in the payment processing platform* Used by: AuthorizationService

* *PaymentAuthorizedEvent.java*: Event fired when a payment transaction has been successfully authorized by the AuthorizationService* Used by: SettlementService

* *PaymentRejectedEvent.java*: Event fired when a payment transaction has been rejected by the AuthorizationService* Used by: OrderService (compensation)

* *PaymentSettledEvent.java*: Event fired when a payment transaction has been successfully settled with the payment processor* Used by: OrderService (completion)

* *Payment.java*: Domain model representing full payment lifecycle
  *PaymentStatus enum*:
** INITIATED, AUTHORIZED, REJECTED, SETTLED, FAILED

##############################################


== ✔️ authorization-service-ri (7010)

* Authorization engine that evaluates payment transactions against business rules and risk criteria

* Performs real-time authorization decisions based on amount limits, risk scoring, merchant validation, and currency support to ensure secure payment processing.

---

* Process PaymentInitiatedEvent
** Generate PaymentAuthorizedEvent or PaymentRejectedEvent

---

* http://localhost:7010/h2-console/login.do


----
curl --location 'http://localhost:8081/api/authorization/test' \
--header 'Content-Type: application/json' \
--data '{
    "orderId": "order-123",
    "amount": "100.00",
    "currency": "USD",
    "userId": "user-123",
    "merchantId": "merchant-456",
    "paymentMethod": "CREDIT_CARD"
}'
----

* *Location*:`/Users/nareshchaurasia/nc/Java-Architect/EventDriven-Architecture-Axon/authorization-service-ri-lti`

* *Purpose*:Payment authorization and risk assessment

##############################################

==== Components / Classes

* *AuthorizationRulesEngine.java*

Authorization engine that evaluates payment transactions against business rules and risk criteria* Performs real-time authorization decisions based on amount limits, risk scoring, merchant validation, and currency support to ensure secure payment processing.

* *AuthorizationResult.java*: Result object containing the outcome of payment authorization evaluation.

* *AuthorizationEventHandler.java*: Axon event handler
* Receives: PaymentInitiatedEvent* How* Put in the event bus.
* Publishes: PaymentAuthorizedEvent or PaymentRejectedEvent
* Integration: Axon EventBus

* *AuthorizationController.java*: REST API controller
** Endpoint: POST `/api/authorization/test`
** Purpose: Test authorization workflow

* *XStreamConfig.java*: XStream configuration for secure XML serialization in the authorization service* Configures allowed package patterns for payment platform events and models to prevent security vulnerabilities during event serialization/deserialization with Axon Framework.

##############################################

---

=== Event Flow Architecture

* *Payment Authorization Workflow*
* REST API → AuthorizationController.test()
* EventBus.publish(PaymentInitiatedEvent)
* AuthorizationEventHandler.on(PaymentInitiatedEvent)
* AuthorizationRulesEngine.evaluate(event)
* Business Rules → AuthorizationResult
* EventBus.publish(PaymentAuthorizedEvent OR PaymentRejectedEvent)
* Downstream services process results

* *Integration Points*

* *Downstream*
** SettlementService

* *Infrastructure*
** Axon Server (event distribution)
** H2 Database (audit and rule storage)

##############################################

=== Start Authorization Service

----
mvn spring-boot:run

curl -X POST http://localhost:8081/api/authorization/test \
  -H "Content-Type: application/json" \
  -d '{"orderId":"order-123","amount":"100.00","currency":"USD","userId":"user-123","merchantId":"merchant-456","paymentMethod":"CREDIT_CARD"}'


2026-02-09T21:46:56.572+05:30  INFO 62841 --- [tion.handler]-0] c.p.p.a.h.AuthorizationEventHandler      : 1* Processing payment authorization for paymentId: ec4848c3-75bc-4c77-92f7-4c7f057f5f74
2026-02-09T21:46:56.572+05:30  INFO 62841 --- [tion.handler]-0] c.p.p.a.s.AuthorizationRulesEngine       : 2* Evaluating authorization rules for payment: ec4848c3-75bc-4c77-92f7-4c7f057f5f74
2026-02-09T21:46:56.572+05:30  INFO 62841 --- [tion.handler]-0] c.p.p.a.s.AuthorizationRulesEngine       : 3.Authorization result for payment ec4848c3-75bc-4c77-92f7-4c7f057f5f74: approved=true, riskScore=0
2026-02-09T21:46:56.572+05:30  INFO 62841 --- [tion.handler]-0] c.p.p.a.h.AuthorizationEventHandler      : 4* Payment authorized: ec4848c3-75bc-4c77-92f7-4c7f057f5f74

----

*Expected Results*

* Valid payments → PaymentAuthorizedEvent
* Invalid payments → PaymentRejectedEvent with error codes
* Logs show full authorization trail
* Events visible in Axon Dashboard at [http://localhost:8024](http://localhost:8024)

---

##############################################


== Axon Server (8024)

* Download: https://download.axoniq.io/axonserver/AxonServer-4.6.7.zip

----
/Users/nareshchaurasia/nc/Java-Architect/AxonServer-4.6.7
java -jar axonserver.jar
----

##############################################

I chose Axon Framework + Axon Server over Apache Kafka because Axon is a higher-level framework built specifically for domain-driven, event-driven systems.

Axon provides built-in support for commands, aggregates, event storage, and sagas, which map naturally to a payment lifecycle and ensure strong consistency and clean separation of concerns. This allowed me to focus on business workflow correctness rather than building infrastructure plumbing.

Kafka is excellent for high-throughput event streaming and large-scale data pipelines, but it requires additional frameworks to implement domain patterns like CQRS and workflow orchestration.

*Trade-off*: Axon improves developer productivity and domain modeling, while Kafka offers greater scalability and ecosystem flexibility. For a payment system focused on correctness and rapid development, Axon was the better fit.


##############################################

curl -X GET "http://localhost:8024/v1/events" \
  -H "Content-Type: application/json"


Command(POSTMAN) → PaymentInitiatedEvent → Authorization Logic → PaymentAuthorizedEvent

nareshchaurasia@Nareshs-MacBook-Pro nc % curl -X GET "http://localhost:8024/v1/events" \ -H "Content-Type: application/json"

* id:1

data:{"messageIdentifier":"2ecc17f0-e398-41a3-b7fc-5d49208574d0","aggregateIdentifier":"","aggregateSequenceNumber":0,"aggregateType":"","payload":{"type":"com.payment.platform.core.events.*PaymentInitiatedEvent*","data":"<com.payment.platform.core.events.PaymentInitiatedEvent>\n  <paymentId>677495be-26a8-430a-a676-089ff0adb461</paymentId>\n  <orderId>order-123</orderId>\n  <timestamp>2026-02-14T12:56:01.557579</timestamp>\n  <amount>100.00</amount>\n  <currency>USD</currency>\n  <userId>user-123</userId>\n  <merchantId>merchant-456</merchantId>\n  <paymentMethod>CREDIT_CARD</paymentMethod>\n</com.payment.platform.core.events.PaymentInitiatedEvent>","revision":""},"timestamp":1771053961558,"metaData":{}}

* id:2

data:{"messageIdentifier":"2d74ea43-db99-4602-9287-f6ddca0d5455","aggregateIdentifier":"","aggregateSequenceNumber":0,"aggregateType":"","payload":{"type":"com.payment.platform.core.events.*PaymentAuthorizedEvent*","data":"<com.payment.platform.core.events.PaymentAuthorizedEvent>\n  <paymentId>677495be-26a8-430a-a676-089ff0adb461</paymentId>\n  <orderId>order-123</orderId>\n  <timestamp>2026-02-14T12:56:01.855482</timestamp>\n  <authorizationCode>AUTH_A2E13DBB</authorizationCode>\n  <riskScore>0</riskScore>\n  <amount>100.00</amount>\n</com.payment.platform.core.events.PaymentAuthorizedEvent>","revision":""},"timestamp":1771053961855,"metaData":{"traceId":"2ecc17f0-e398-41a3-b7fc-5d49208574d0","correlationId":"2ecc17f0-e398-41a3-b7fc-5d49208574d0"}}

* id:3

data:{"messageIdentifier":"478a67e7-007b-4c9d-99e3-485340587765","aggregateIdentifier":"","aggregateSequenceNumber":0,"aggregateType":"","payload":{"type":"com.payment.platform.core.events.*PaymentSettledEvent*","data":"<com.payment.platform.core.events.PaymentSettledEvent>\n  <paymentId>677495be-26a8-430a-a676-089ff0adb461</paymentId>\n  <orderId>order-123</orderId>\n  <timestamp>2026-02-14T15:43:21.33997</timestamp>\n  <settlementId>SETTLE_1771064001339_4801</settlementId>\n  <settlementDate>2026-02-14T15:43:21.339959</settlementDate>\n</com.payment.platform.core.events.PaymentSettledEvent>","revision":""},"timestamp":1771064001340,"metaData":{"traceId":"2ecc17f0-e398-41a3-b7fc-5d49208574d0","correlationId":"2d74ea43-db99-4602-9287-f6ddca0d5455"}}

* id:4

data:{"messageIdentifier":"b6f11469-95eb-447a-bd66-245ea2f4a318","aggregateIdentifier":"","aggregateSequenceNumber":0,"aggregateType":"","payload":{"type":"com.payment.platform.core.events.*PaymentAuthorizedEvent*","data":"<com.payment.platform.core.events.PaymentAuthorizedEvent>\n  <paymentId>677495be-26a8-430a-a676-089ff0adb461</paymentId>\n  <orderId>order-123</orderId>\n  <timestamp>2026-02-15T08:42:18.657874</timestamp>\n  <authorizationCode>AUTH_9A06480A</authorizationCode>\n  <riskScore>0</riskScore>\n  <amount>100.00</amount>\n</com.payment.platform.core.events.PaymentAuthorizedEvent>","revision":""},"timestamp":1771125138657,"metaData":{"traceId":"2ecc17f0-e398-41a3-b7fc-5d49208574d0","correlationId":"2ecc17f0-e398-41a3-b7fc-5d49208574d0"}}

##############################################

== settlment-service-ri (7020)

TODO: Change Port to 7020 (port does not make a difference)

 * Receives PaymentAuthorizedEvent via Axon Framework
 * Delegates to SettlementProcessor for payment processing
 * Publishes PaymentSettledEvent or handles settlement failures
 * Handles exceptions and implements retry logic


----
ler   : 1* Processing payment settlement for authorized paymentId: 677495be-26a8-430a-a676-089ff0adb461
2026-02-14T15:43:21.338+05:30  INFO 73743 --- [ment.handler]-0] c.p.p.s.handler.SettlementEventHandler   : Event received - PaymentId: 677495be-26a8-430a-a676-089ff0adb461, OrderId: order-123, AuthCode: AUTH_A2E13DBB, RiskScore: 0, Amount: 100.00
2026-02-14T15:43:21.338+05:30  INFO 73743 --- [ment.handler]-0] c.p.p.s.handler.SettlementEventHandler   : 2* Delegating to SettlementProcessor for payment: 677495be-26a8-430a-a676-089ff0adb461
2026-02-14T15:43:21.339+05:30  INFO 73743 --- [ment.handler]-0] c.p.p.s.service.SettlementProcessor      : 2* Processing settlement for authorized payment: 677495be-26a8-430a-a676-089ff0adb461
2026-02-14T15:43:21.339+05:30  INFO 73743 --- [ment.handler]-0] c.p.p.s.service.SettlementProcessor      : Payment details - Amount: 100.00, Auth Code: AUTH_A2E13DBB, Risk Score: 0
2026-02-14T15:43:21.339+05:30  INFO 73743 --- [ment.handler]-0] c.p.p.s.service.SettlementProcessor      : Attempt 1 to settle payment: 677495be-26a8-430a-a676-089ff0adb461
2026-02-14T15:43:21.339+05:30  INFO 73743 --- [ment.handler]-0] c.p.p.s.service.SettlementProcessor      : 3* Payment settled successfully: 677495be-26a8-430a-a676-089ff0adb461, settlementId: SETTLE_1771064001339_4801
2026-02-14T15:43:21.341+05:30  INFO 73743 --- [ment.handler]-0] c.p.p.s.handler.SettlementEventHandler   : 4* Payment settlement completed: 677495be-26a8-430a-a676-089ff0adb461, settlementId: SETTLE_1771064001339_4801
----

##############################################

curl -X GET "http://localhost:8024/v1/events"


id:1
data:{"messageIdentifier":"2ecc17f0-e398-41a3-b7fc-5d49208574d0","aggregateIdentifier":"","aggregateSequenceNumber":0,"aggregateType":"","payload":{"type":"com.payment.platform.core.events.PaymentInitiatedEvent","data":"<com.payment.platform.core.events.*PaymentInitiatedEvent*>\n  <paymentId>677495be-26a8-430a-a676-089ff0adb461</paymentId>\n  <orderId>order-123</orderId>\n  <timestamp>2026-02-14T12:56:01.557579</timestamp>\n  <amount>100.00</amount>\n  <currency>USD</currency>\n  <userId>user-123</userId>\n  <merchantId>merchant-456</merchantId>\n  <paymentMethod>CREDIT_CARD</paymentMethod>\n</com.payment.platform.core.events.PaymentInitiatedEvent>","revision":""},"timestamp":1771053961558,"metaData":{}}

id:2
data:{"messageIdentifier":"2d74ea43-db99-4602-9287-f6ddca0d5455","aggregateIdentifier":"","aggregateSequenceNumber":0,"aggregateType":"","payload":{"type":"com.payment.platform.core.events.PaymentAuthorizedEvent","data":"<com.payment.platform.core.events.*PaymentAuthorizedEvent*>\n  <paymentId>677495be-26a8-430a-a676-089ff0adb461</paymentId>\n  <orderId>order-123</orderId>\n  <timestamp>2026-02-14T12:56:01.855482</timestamp>\n  <authorizationCode>AUTH_A2E13DBB</authorizationCode>\n  <riskScore>0</riskScore>\n  <amount>100.00</amount>\n</com.payment.platform.core.events.PaymentAuthorizedEvent>","revision":""},"timestamp":1771053961855,"metaData":{"traceId":"2ecc17f0-e398-41a3-b7fc-5d49208574d0","correlationId":"2ecc17f0-e398-41a3-b7fc-5d49208574d0"}}

id:3
data:{"messageIdentifier":"478a67e7-007b-4c9d-99e3-485340587765","aggregateIdentifier":"","aggregateSequenceNumber":0,"aggregateType":"","payload":{"type":"com.payment.platform.core.events.PaymentSettledEvent","data":"<com.payment.platform.core.events.*PaymentSettledEvent*>\n  <paymentId>677495be-26a8-430a-a676-089ff0adb461</paymentId>\n  <orderId>order-123</orderId>\n  <timestamp>2026-02-14T15:43:21.33997</timestamp>\n  <settlementId>SETTLE_1771064001339_4801</settlementId>\n  <settlementDate>2026-02-14T15:43:21.339959</settlementDate>\n</com.payment.platform.core.events.PaymentSettledEvent>","revision":""},"timestamp":1771064001340,"metaData":{"traceId":"2ecc17f0-e398-41a3-b7fc-5d49208574d0","correlationId":"2d74ea43-db99-4602-9287-f6ddca0d5455"}}

##############################################

---

== Notification Service Role (7030)

*What It Does:*
- Receives events from Axon Server (PaymentSettledEvent, PaymentRejectedEvent, etc.)
- Sends notifications (email, SMS, push notifications)
- Logs notifications to database for audit trail
- Provides REST APIs to query notification status

*What It Does NOT Do:*
- Does NOT publish events back to Axon Server
- Does NOT trigger other services
- Does NOT participate in command/query flow

*Event Flow Architecture*

----
REST API → Authorization Service → Axon Server
    ↓
PaymentInitiatedEvent → Authorization Service
    ↓  
PaymentAuthorizedEvent → Settlement Service
    ↓
PaymentSettledEvent → Notification Service (TERMINAL)
    ↓
[Email/SMS sent] → END
----

*Why This Design Makes Sense*
- Single Responsibility: Notification service only handles notifications
- No Side Effects: Sending notifications shouldn't trigger business logic
- Audit Trail: Notifications are logged but don't affect payment flow
- Resilience: If notification fails, payment is still complete

*NotificationSentEvent (Alternative - NOT implemented)*

- Could publish NotificationSentEvent for tracking
- Could trigger analytics service
* Could update customer communication preferences
* Adds complexity but provides more observability

##############################################

---


== Reconciliation (7050)

*1* Payment Initiation*

*What happens:* Customer says "I want to pay"

*Simple example:*

* You click "Pay Now" on Amazon
* You enter credit card details
* You click "Confirm Payment"

*What the system does:*

* Creates a payment request: "Customer wants to pay $50"
* Gives it an ID: `PAY-12345`
* Says: "Got it! Starting payment process"

##############################################

---

*2* Payment Authorization*

*What happens:* Bank says "Yes, this payment is okay"

*Simple example:*

* Amazon sends your card details to Visa
* Visa checks: Does customer have money? Is card valid?
* Visa replies: "Yes, approve this $50 charge"

*What the system does:*

* Creates authorization code: `AUTH-789`
* Records: "Payment approved, but money not moved yet"
* Reserves the money in your account

##############################################

---

*3* Payment Settlement*

*What happens:* Money actually moves from customer to merchant

*Simple example:*

* At midnight, Visa tells Amazon's bank: "Move that $50 now"
* Amazon's bank receives the money
* Your card is actually charged $50

*What the system does:*

* Creates settlement record: "Money moved successfully"
* Updates: "Payment is now complete"
* Records settlement ID: `SETTLE-ABC`

##############################################

---

*4* Payment Notification*

*What happens:* Everyone gets told about the payment

*Simple example:*

* Amazon emails you: "Your payment of $50 was successful"
* Amazon's warehouse gets alert: "Ship the order"
* Amazon's accounting sees: "Record this revenue"

*What the system does:*

* Sends email to customer
* Updates order status to "Paid"
* Notifies warehouse to ship product
* Records everything in accounting system

##############################################

---

*5* Payment Reconciliation*

*What happens:* Accountant checks that everything matches perfectly

*Simple example:*

*Next morning, the accountant checks:*

*What should have happened:*

* Customer paid: $50
* Amazon should receive: $48 (after $2 fees)
* Bank should show: $50 moved
* Fees should be: $2

*What actually happened:*

* Customer paid: $50 ✅
* Amazon received: $47.50 ❌ (50 cents missing!)
* Bank shows: $50 ✅
* Fees charged: $2.50 ❌ (50 cents extra!)

*What reconciliation does:*

* *Finds the problem:* "We were overcharged 50 cents in fees!"
* *Flags it:* "Investigate this fee difference"
* *Fixes it:* "Get the 50 cents back from bank"
* *Prevents future issues:* "Check fee calculations carefully"

*Why All 5 Steps Matter*

*Without any step:*

* *No Initiation:* Customer can't start payment
* *No Authorization:* Fraudulent payments happen
* *No Settlement:* Money never actually moves
* *No Notification:* Nobody knows what happened
* *No Reconciliation:* Money disappears without anyone noticing

*With all steps:*

* Customer pays → System knows about it
* Bank approves → No fraud, money is available
* Money moves → Merchant gets paid
* Everyone told → Order ships, customer happy
* Accountant checks → No money lost, no errors

##############################################

---

== Use Cases

=== Payment Rejected

* NotificationEventHandler handles PaymentRejectedEvent
** Direct Call to create PaymentRejectedEvent
** As a result NotificationEventHandler/PaymentRejectedEvent is triggered.
----
curl --location 'http://localhost:7010/api/authorization/reject' \
--header 'Content-Type: application/json' \
--data '{
    "orderId": "order-456",
    "amount": "500.00", 
    "currency": "USD",
    "userId": "user-456",
    "merchantId": "merchant-789",
    "paymentMethod": "CREDIT_CARD"
}'
----


##############################################

---

== Settlement Failure Testing

* *POSTMAN*: settlement-failure
* settlement.test.failure-rate=0.0
* Directly creating PaymentAuthorizedEvent. It will be picked up by SettlementEventHandler.
* There is should log in settlement service.
* TODO - Take action.

=== Testing Settlement Failure Scenarios

The settlement service now supports configurable failure testing to simulate real-world payment processing failures.

=== Configuration Options

*Edit `/settlement-service-ri/src/main/resources/application.properties`:*

----
# Settlement Failure Testing Configuration
settlement.test.failure-rate=0.0  # Set to 0.5 for 50% failure rate, 1.0 for 100% failure
settlement.test.force-failure=false # Set to true to force all settlements to fail
----

=== Test Scenarios

=== Scenario 1: 100% Settlement Failure

*1. Configure settlement service:*
----
settlement.test.force-failure=true
----

*2. Restart settlement service*

*3. Test settlement failure:*
----
curl --location 'http://localhost:8010/api/authorization/test-settlement-failure' \
--header 'Content-Type: application/json' \
--data '{
    "orderId": "order-fail-123",
    "amount": "100.00", 
    "currency": "USD",
    "userId": "user-123",
    "merchantId": "merchant-456",
    "paymentMethod": "CREDIT_CARD"
}'
----

*4. Expected Results:*
** Settlement service logs: "TEST MODE: Forcing settlement failure"
** PaymentFailedEvent published
** Retry attempts logged (3 attempts by default)
** Final failure: "MAX_RETRIES_EXCEEDED"

=== Scenario 2: 50% Random Failure Rate

*1. Configure settlement service:*
----
settlement.test.force-failure=false
settlement.test.failure-rate=0.5
----

*2. Restart settlement service*

*3. Test multiple times to see both success and failure*

=== Scenario 3: Retry Logic Testing

*1. Configure for faster testing:*
----
settlement.retry.max-attempts=2
settlement.retry.delay-ms=500
settlement.test.force-failure=true
----

*2. Observe retry behavior in logs*

=== Event Flow for Settlement Failure

1* REST API → AuthorizationController.testSettlementFailure()
2* EventBus.publish(PaymentAuthorizedEvent)
3* SettlementEventHandler.on(PaymentAuthorizedEvent)
4* SettlementProcessor.processSettlement()
5* Provider simulation → FAILURE
6* Retry attempts (1, 2, 3...)
7* EventBus.publish(PaymentFailedEvent)
8* Downstream services handle failure

=== Monitoring Settlement Failures

*Log patterns to watch:*

----
"TEST MODE: Forcing settlement failure"
"Settlement attempt X failed for payment"
"Settlement failed after X attempts"
"Published PaymentFailedEvent"
----

=== Failure Reasons Simulated

* "Insufficient funds in account"
* "Invalid card details"  
* "Payment provider network error"
* "Transaction declined by risk assessment"

=== Production Considerations

* Always disable test mode in production
* Monitor PaymentFailedEvent rates
* Set up alerts for high failure rates
* Implement manual review workflows


